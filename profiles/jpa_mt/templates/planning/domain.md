{{include: ../_shared/base.md}}
{{include: ../_shared/fallback-rules.md}}
{{include: ../_phases/planning-guidelines.md}}

---

# Domain Layer Planning Request

Produce a **planning document only** for the domain layer (Entity + Repository) for a single table.

You MUST NOT generate any code. Stop after generating the planning document.

---

## Planning Requirements

Your planning document MUST cover:

1. **Schema Analysis** - Table structure, keys, constraints, multi-tenancy pattern
2. **Entity Design** - Class name, package, base class, field mappings
3. **Relationship Mapping** - Type, **Target Entity FQCN**, join columns, fetch strategy
4. **Repository Design** - Interface name, package, query methods
5. **Questions / Clarifications** - Ambiguities requiring developer input

---

## Analysis Guidelines

### From Schema DDL

Identify: target table/schema, all columns (types, nullability, defaults), primary key, foreign keys, constraints, multi-tenancy pattern (tenant-scoped / tenant entity / global).

### From Standards Bundle

Apply: package structure, schema-to-package mapping, base class requirements, naming conventions, JPA mapping rules, multi-tenancy patterns.

### Relationship Analysis (CRITICAL)

For each foreign key, you MUST determine the **fully-qualified Target Entity class name**:
- Use schema-to-package mapping from standards
- `app` schema → `com.example.app.domain.<context>.<Entity>`
- `global` schema → `com.example.global.domain.<context>.<Entity>`

If the package cannot be determined, add to "Questions for Developer" section.

### Repository Query Planning

Plan queries appropriate for entity type: by primary key, by public identifier, by business keys. Apply tenant scoping per standards.

---

## Output Format
```yaml
---
Generated by: [AI model]
Generated at: [UTC timestamp]
---
```
```markdown
# Domain Layer Planning Document

## Entity: {{ENTITY}}

**Table:** {{TABLE}}  
**Bounded Context:** {{BOUNDED_CONTEXT}}  
**Multi-Tenancy Model:** [Tenant-Scoped / Tenant Entity / Global]

---

## 1. Schema Analysis

### Table: [schema].[table_name]

| Column Name | Type | Constraints | Notes |
|-------------|------|-------------|-------|
| ... | ... | ... | ... |

**Foreign Keys:** `[column]` → `[table].[column]`  
**Multi-Tenancy:** [model and tenant column if any]

---

## 2. Entity Design Plan

**Package:** [full package path]  
**Class:** [EntityName]  
**Base Class:** [if any, with inherited fields]

### Fields to Declare

**[fieldName]**: `[JavaType]`  
- Column: `[column_name]`, Constraints: [nullability, etc.]

---

## 3. Relationship Mapping Plan

**Relationship: [Entity] → [RelatedEntity]**  
- **Type:** @ManyToOne / @OneToMany / etc.  
- **Target Entity:** `[fully.qualified.ClassName]`  
- **Field name:** [fieldName]  
- **Join Column:** @JoinColumn(name = "[column]")  
- **Fetch Strategy:** LAZY / EAGER

---

## 4. Repository Design Plan

**Interface:** [EntityRepository]  
**Package:** [same as entity]  
**Base:** JpaRepository<Entity, Long>

**Query Methods:**
- `[methodName]([params])` — [description]

---

## 5. Special Considerations

[JSON fields, enums, timestamps, soft delete - or "None"]

---

## 6. Questions for Developer

[Ambiguities not resolved by schema + standards + fallback rules]

---

## 7. Summary

**Complexity:** Low/Medium/High | **Fields:** N | **Relationships:** N | **Multi-Tenancy:** [type]
```

---

## Pre-Output Validation

Before generating, verify:
1. Schema DDL analyzed, target table found
2. Standards applied, package structure determined
3. All relationship Target Entity FQCNs determined or flagged as questions
4. No assumptions beyond schema + standards + fallbacks

If validation fails, emit single-line error message and no planning document.

---

## Output Destination

Save your complete planning document as `planning-response.md` to same location as `planning-prompt.md`.