{{include: ../_shared/base.md}}
{{include: ../_shared/fallback-rules.md}}
{{include: ../_phases/planning-guidelines.md}}

---

# Vertical Slice Planning Request

Produce a **planning document only** for a complete vertical slice from entity to controller.

You MUST NOT generate any code. Stop after generating the planning document.

---

## Planning Requirements

Your planning document MUST cover:

1. **Schema Analysis** - Table structure, keys, constraints, multi-tenancy pattern
2. **Entity Design** - Class name, package, base class, field mappings
3. **Relationship Mapping** - Type, **Target Entity FQCN**, join columns, fetch strategy
4. **Repository Design** - Interface name, package, query methods
5. **Service Design** - Class name, methods, transaction boundaries, tenant scoping
6. **Controller Design** - Endpoints, HTTP methods, request/response structure
7. **DTO Design** - Request/response DTOs, validation rules
8. **Mapper Design** - Mapping approach, fields to map
9. **Questions / Clarifications** - Ambiguities requiring developer input

---

## Analysis Guidelines

### From Schema DDL

Identify: target table/schema, all columns (types, nullability, defaults), primary key, foreign keys, constraints, multi-tenancy pattern (tenant-scoped / tenant entity / global).

### From Standards Bundle

Apply: package structure, schema-to-package mapping, base class requirements, naming conventions, JPA mapping rules, multi-tenancy patterns, service patterns, API conventions.

### Relationship Analysis (CRITICAL)

For each foreign key, you MUST determine the **fully-qualified Target Entity class name**:
- Use schema-to-package mapping from standards
- `app` schema → `com.example.app.domain.<context>.<Entity>`
- `global` schema → `com.example.global.domain.<context>.<Entity>`

If the package cannot be determined, add to "Questions for Developer" section.

---

## Output Format
```yaml
---
Generated by: [AI model]
Generated at: [UTC timestamp]
---
```
```markdown
# Vertical Slice Planning Document

## Entity: {{ENTITY}}

**Table:** {{TABLE}}  
**Bounded Context:** {{BOUNDED_CONTEXT}}  
**Multi-Tenancy Model:** [Tenant-Scoped / Tenant Entity / Global]

---

## 1. Schema Analysis

[Same as domain planning]

---

## 2. Entity Design Plan

[Same as domain planning]

---

## 3. Relationship Mapping Plan

[Same as domain planning]

---

## 4. Repository Design Plan

[Same as domain planning]

---

## 5. Service Design Plan

**Class:** [EntityService]  
**Package:** [service package path]

**Methods:**
- `[methodName]([params])` — [description, transaction boundary, tenant scoping]

---

## 6. Controller Design Plan

**Class:** [EntityController]  
**Package:** [controller package path]  
**Base Path:** [API base path]

**Endpoints:**
- `[HTTP METHOD] [path]` — [description, request/response types]

---

## 7. DTO Design Plan

**Request DTOs:**
- `[DtoName]` — [fields, validation rules]

**Response DTOs:**
- `[DtoName]` — [fields]

---

## 8. Mapper Design Plan

**Approach:** [Manual / MapStruct / etc.]  
**Mappings:**
- `[Entity] ↔ [Dto]` — [field mappings, transformations]

---

## 9. Special Considerations

[JSON fields, enums, timestamps, soft delete, pagination - or "None"]

---

## 10. Questions for Developer

[Ambiguities not resolved by schema + standards + fallback rules]

---

## 11. Summary

**Complexity:** Low/Medium/High | **Artifacts:** N | **Endpoints:** N | **Multi-Tenancy:** [type]
```

---

## Pre-Output Validation

Before generating, verify:
1. Schema DDL analyzed, target table found
2. Standards applied, all package structures determined
3. All relationship Target Entity FQCNs determined or flagged as questions
4. All layers (entity through controller) planned
5. No assumptions beyond schema + standards + fallbacks

If validation fails, emit single-line error message and no planning document.
